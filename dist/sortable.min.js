"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function n(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(t,e,i){return e&&n(t.prototype,e),i&&n(t,i),t}}();function _toConsumableArray(t){if(Array.isArray(t)){for(var e=0,i=Array(t.length);e<t.length;e++)i[e]=t[e];return i}return Array.from(t)}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var sortablejs=function(){function f(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},e=t.parent,i=void 0===e?document.querySelector("#sjs"):e,n=t.links,s=void 0===n?document.querySelectorAll("[data-sjslink]"):n,a=t.active,r=void 0===a?"is-active":a,o=t.margin,l=void 0===o?20:o,u=t.responsive,c=void 0===u?{980:{columns:3},480:{columns:2},0:{columns:1}}:u,h=t.fadeDuration,d=void 0===h?{in:300,out:0}:h;_classCallCheck(this,f),this.parent=i,this.links=Array.from(s),this.active=r,this.margin=l,this.responsive=c,this.fadeDuration=d,this.elements=Array.from(this.parent.children),this.activeElements=this.elements,this.columns=1,this.dataLink="all",this.winWidth=window.innerWidth,this.init()}return _createClass(f,[{key:"orderelements",value:function(){var r=this,t=this.parent,e=this.activeElements,o=this.columns,l=this.blocWidth,u=(this.responsive,this.margin),i=e.reduce(function(t,e,i){var n=r._sumArrHeight(t,o),s=i%o*(l+u),a=0<=i-o?n[i%o]+u*Math.floor(i/o):0;return e.style.transform="translate3d("+s+"px, "+a+"px, 0)",t.push(e.offsetHeight),t},[]),n=this._sumArrHeight(i,o),s=Math.max.apply(Math,_toConsumableArray(n))+u*(Math.floor(e.length/o)-1);t.style.height=s+"px"}},{key:"handleFilterClick",value:function(t,e){var i=this;t.preventDefault();var n=this.links,s=this.active;e.dataset.sjslink!==this.dataLink&&(this.dataLink=e.dataset.sjslink,n.forEach(function(t){t.isEqualNode(e)?t.classList.add(s):t.classList.remove(s)}),this._filterElements(function(){i.orderelements()}))}},{key:"resize",value:function(){var t=this;window.addEventListener("resize",function(){clearTimeout(window.sortableResize),window.sortableResize=setTimeout(function(){t.winWidth=window.innerWidth,t._setBlocWidth(function(){t.orderelements()})},500)})}},{key:"init",value:function(){var i=this,t=this.parent,e=this.links,n=this.active;e.forEach(function(e,t){0===t&&(e.classList.add(n),i.dataLink=e.dataset.sjslink),e.addEventListener("click",function(t){i.handleFilterClick(t,e)})}),this._setBlocWidth(),window.addEventListener("load",function(){i._filterElements(function(){i.orderelements()}),t.style.opacity=1}),this.resize()}},{key:"_setBlocWidth",value:function(t){var e=this.parent,i=this.elements,n=this.margin,s=this.responsive,a=this.columns=this._columnsCount(s).columns,r=this.blocWidth=(e.clientWidth-n*(a-1))/a;i.forEach(function(t){t.style.width=r+"px"}),t&&t()}},{key:"_filterElements",value:function(t){var e=this,i=this.elements,n=this.dataLink,s=this.fadeDuration;this.activeElements=i.filter(function(t){return"all"===n?(e._fadeIn(t,s.in),!0):t.dataset.sjsel!==n?(e._fadeOut(t,s.out),!1):(e._fadeIn(t,s.in),!0)}),t&&t()}},{key:"_sumArrHeight",value:function(t,s){return t.reduce(function(t,e,i){var n=i%s;return t[n]||(t[n]=0),t[n]=t[n]+e,t},[])}},{key:"_columnsCount",value:function(t){var i=this.winWidth;return Object.entries(t).reduce(function(t,e){return i>e[0]&&e[0]>=Math.max(t.width)?{width:e[0],columns:e[1].columns}:t},{width:0,columns:4})}},{key:"_fadeIn",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:300,i=arguments[2],n=parseFloat(window.getComputedStyle(e,null).getPropertyValue("opacity")),s=16/t;e.style.display="block",requestAnimationFrame(function t(){(n+=s)<=1?(e.style.opacity=n,requestAnimationFrame(t)):(e.style.opacity=1,i&&i())})}},{key:"_fadeOut",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:300,i=arguments[2],n=parseFloat(window.getComputedStyle(e,null).getPropertyValue("opacity")),s=t?16/t:1;requestAnimationFrame(function t(){0<=(n-=s)?(e.style.opacity=n,requestAnimationFrame(t)):(e.style.opacity=0,e.style.display="none",i&&i())})}}]),f}();exports.default=sortablejs;